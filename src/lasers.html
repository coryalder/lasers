<style>
  @import "./styles.css";
</style>

<script language="javascript" src="laserpanels.js" id="LASERPANEL" type="module" defer></script>

<div class="grid container-fluid">
  <div id="parameters" class="item" x-data="$store.panel">
    <table>
      <tr>
        <td>
          <label class="buttongrid upload" for="file-upload">
            Import Panel Definition
            <input id="file-upload" type="file" accept=".json,application/json" hidden="true" @change="ImportExport.loadData($store.panel, $event)" />
          </label>
        </td>
        <td>
          <button class="buttongrid" @click="ImportExport.saveSvg($store.panel)">Export Panel as SVG</button>
        </td>
      </tr>
      <tr>
        <td>
          <button class="buttongrid" @click="ImportExport.saveData($store.panel)">Export Panel Definition</button>
        </td>
        <td>
          <button class="buttongrid" @click="ImportExport.saveDxf($store.panel)">Export Panel as DXF</button>
        </td>
      </tr>
    </table>
    <table class="outlined-table">
      <tr>
        <td colspan="2"><span class="sectiontitle">Panel setup</span></td>
      </tr>
      <tr>
        <td>
          Format:
        </td>
        <td>
          <select x-model.number="vp_index" @change="re_render($store.panel)">
            <template x-for="(vp_option, index) in info.vp_options" :key="index">
              <option x-text="vp_option.display" :value="index" :selected="index === vp_index"></option>
            </template>
          </select>
        </td>
      </tr>
      <tr>
        <td>
          Width (<span for="hp_index" x-text="info.hp_options[hp_index].hp"></span>HP): 
        </td>
        <td>
          <input type="range"
          :max="Object.keys(info.hp_options).length-1"
          min="0" :value="hp_index"
          class="slider"
          id="hp_index"
          x-model.number="hp_index"
          @change="re_render($store.panel)">  
        </td>
      </tr>
      <tr>
        <td>
          <a href="#doepferinsets">Doepfer Insets</a>
        </td>
        <td>
          <label for="hp_inset" style="display: inline">
            <input type="checkbox" x-model="hp_inset" @change="re_render($store.panel)" id="hp_inset" name="hp_inset" role="switch">
            Enabled
          </label>
        </td>
      </tr>
      <tr>
        <td>
          Screw configuration:
        </td>
        <td>
          <select x-model.number="holes_index" @change="re_render($store.panel)" style="width: 45%; margin-right: 0.5em;">
            <template x-for="(hole, index) in info.hole_positions" :key="index">
                <option x-text="hole.display" :value="index" :selected="index === holes_index"></option>
            </template>
          </select>
          <label for="switch" style="display: inline">
            <input type="checkbox" x-model="oval_screwholes" @change="re_render($store.panel)" id="ovals" name="switch" role="switch">
            Oval
          </label>
        </td>
      </tr>
    </table>
    <table class="outlined-table">
      <tr>
        <td colspan="2"><span class="sectiontitle">Add features</span></td>
      </tr>
      <tr>
        <td colspan="2">
          <div class="addbuttons">
            <template x-for="(feature_name, feature_type) in info.feature_types">
              <button x-text="feature_name" @click="addFeature(feature_type)"></button>
            </template>
            </div>
        </td>
      </tr>
    </table>

    <template x-for="(feature, index) in features" :key="index">
    <table class="outlined-table">
        <tr>
          <td class="feature-table-top-cell" colspan="2">
            <span x-text="(index+1) + '. ' + info.feature_types[feature.type]" class="featuretitle"></span>
            <span style="float:right;"><button @click="deleteFeature(index)">Delete feature</button></span>
          </td>
        </tr>
        <tr>
          <td>
            Size:
          </td>
          <td>
            <select x-model="feature.identifier" @change="re_render($store.panel)">
              <template x-for="size_option in info.feature_size_options[feature.type]" :key="size_option.identifier">
                <option x-text="size_option.display" :value="size_option.identifier" :selected="size_option.identifier === feature.identifier"></option>
              </template>
            </select>
          </td>
          <tr>
            <td>
              Position (X, Y):
            </td>
            <td>
              <input type="number" step="0.5" x-model="feature.position.x" @change="re_render($store.panel)" style="width: 49%;">
              <input type="number" step="0.5" x-model="feature.position.y" @change="re_render($store.panel)" style="width: 49%;">
            </td>
          </tr>
          <tr>
            <td class="feature-table-bottom-cell">
              Relative to:
            </td>
            <td class="feature-table-bottom-cell">
              <select x-model="feature.position.relative_to" @change="re_render($store.panel)">
                <template x-for="(pos, index) in info.frames_of_reference" :key="index">
                  <option x-text="pos.display" :value="index" :selected="index === feature.position.relative_to"></option>
                </template>
              </select>
            </td>
          </tr>
            <tr x-show="can_be_flipped(feature.type, feature.identifier)">
              <td>
                Orientation:
              </td>
              <td>
                <label for="horizontal" style="display: inline">
                  <input type="checkbox" x-model="feature.rot90" @change="re_render($store.panel)" id="horizontal" name="horizontal" role="switch">
                  Rotated
                </label>
              </td>
            </tr>
          </template>
        </table>
      </template>
  </div>
  <div id="jscad" class="item"></div>
</div>

<div class="notes">
  <h2>Notes</h2>
  <h4>Getting panels cut</h4>
  <p>
    There are many online services that will laser cut something out for you, but we recommned finding a local hackspace / maker space and learning to laser yourself, or finding someone in your community with a laser cutter and a soft spot for synth nerds. You might make a new friend, and you'll definitely save some money.
  </p>
  <h4>Validating the design</h4>
  <p>
    If you're laser cutting these yourself, we strongly recommend cutting them out in cardboard first, to validate everything is positioned correctly. If you're sending them off to be cut, you can print them out on paper and cut out the holes with an exacto-knife.
  </p>
  <h4>Cutting order</h4>
  <p>
    Make sure to cut out the holes first. Once you've cut the outline of your panel, it will move out of place, and cause the holes to be in the wrong place.
  </p>
  <h4>Other projects</h4>
  <p>
    There are other projects that tackle generating synth panels, if you're interested in trying a project with a different focus, check out:
    <ul>
      <li>SYNSI's <a href="https://syinsi.com/eurorack-panel-designer-for-inkscape/">Eurorack Panel Designer</a> for Inkscape</li>
      <li>FASELUNARE's <a href="http://www.synthpanels.design/">Synth Panel Designer</a> for Inkscape</li>
      <li>joem's <a href="https://github.com/joem/kicad-eurorack-panel-generator">KiCad Eurorack Panel Generator</a></li>
    </ul>
      
  </p>
  <h4>Rules used to generate these panels:</h4>
  <ul x-data>
    <li>Eurorack panels are <span x-text="info.vp_options[2].height"></span>mm high</li>
    <li>1U "Pulp Logic" Tiles follow the spec laid out by <a href="http://pulplogic.com/1u_tiles/">PulpLogic</a> and are <span x-text="info.vp_options[0].height"></span>mm high</li>
    <li>1U "Intellijel" Tiles follow the spec laid out by <a href="https://intellijel.com/support/1u-technical-specifications/">Intellijel</a> and are <span x-text="info.vp_options[1].height"></span>mm high</li>
    <li>Eurorack screws are inset <span x-text="(info.vp_options[2].height-info.vp_options[2].screw_height)/2"></span>mm from each side</li>
    <li>Eurorack screw holes are <span x-text="info.constants.screw_hole_radius*2"></span>mm in diamter</li>
    <li>1 HP is <span x-text="info.constants.horizontal_pitch_mm"></span>mm</li>
    <li>Screw hole spacing is calculated as <code>max(module_hp - 3, 0) * 1HP</code></li>
    <li id="doepferinsets">Doepfer Insets: In the official spec, the actual width of a eurorack panel is slightly less than the <a href="https://doepfer.de/a100_man/a100m_e.htm">calculated width</a>, to leave a small space between panels. This part of the spec isn't always followed.</li>
    <li>Slide potentiometers require a <span x-text="info.constants.slidepot_width"></span>mm opening</li>
    <li>Rotary potentiometers require about a <span x-text="info.constants.rotarypot_margin"></span>mm margin</li>
    <li>The exported files make NO attempt to account for laser kerf width.</li>
  </ul>
</div>
